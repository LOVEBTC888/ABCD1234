<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.60">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/abcjs/favicon.ico"><link rel="stylesheet" type="text/css" href="https://paulrosen.github.io/abcjs/abcjs-audio.css"><script src="https://paulrosen.github.io/abcjs/dist/abcjs-basic.js" type="text/javascript"></script><title>Timing Callbacks | abcjs</title><meta name="description" content="JavaScript library for displaying sheet music in a browser.">
    <link rel="preload" href="/abcjs/assets/style-db0a616d.css" as="style"><link rel="stylesheet" href="/abcjs/assets/style-db0a616d.css">
    <link rel="modulepreload" href="/abcjs/assets/app-59542f1f.js"><link rel="modulepreload" href="/abcjs/assets/framework-2ecd7faa.js"><link rel="modulepreload" href="/abcjs/assets/timing-callbacks.html-f4bcdedd.js"><link rel="modulepreload" href="/abcjs/assets/timing-callbacks.html-be9a7a38.js"><link rel="prefetch" href="/abcjs/assets/index.html-919d411d.js" as="script"><link rel="prefetch" href="/abcjs/assets/tune-book.html-09b714cf.js" as="script"><link rel="prefetch" href="/abcjs/assets/synthesized-sound.html-6cdf1b03.js" as="script"><link rel="prefetch" href="/abcjs/assets/deprecated-api.html-4d0111e5.js" as="script"><link rel="prefetch" href="/abcjs/assets/basic-architecture.html-4c21a961.js" as="script"><link rel="prefetch" href="/abcjs/assets/pull-requests.html-1153c960.js" as="script"><link rel="prefetch" href="/abcjs/assets/releasing.html-b8203ee6.js" as="script"><link rel="prefetch" href="/abcjs/assets/interactive-editor.html-640a5530.js" as="script"><link rel="prefetch" href="/abcjs/assets/abc-notation.html-629ce356.js" as="script"><link rel="prefetch" href="/abcjs/assets/example-generator.html-50abf41c.js" as="script"><link rel="prefetch" href="/abcjs/assets/examples.html-83a969d0.js" as="script"><link rel="prefetch" href="/abcjs/assets/faq.html-4066ace6.js" as="script"><link rel="prefetch" href="/abcjs/assets/getting-started.html-435596cf.js" as="script"><link rel="prefetch" href="/abcjs/assets/purpose.html-1b9adcba.js" as="script"><link rel="prefetch" href="/abcjs/assets/resources.html-d94fa85a.js" as="script"><link rel="prefetch" href="/abcjs/assets/plugin.html-cbda95cd.js" as="script"><link rel="prefetch" href="/abcjs/assets/transposing.html-92555cc2.js" as="script"><link rel="prefetch" href="/abcjs/assets/midijs.html-91eb85ef.js" as="script"><link rel="prefetch" href="/abcjs/assets/release-notes.html-6054e914.js" as="script"><link rel="prefetch" href="/abcjs/assets/classes.html-660e7022.js" as="script"><link rel="prefetch" href="/abcjs/assets/click-listener.html-bd23ba0f.js" as="script"><link rel="prefetch" href="/abcjs/assets/dragging.html-5f3f539c.js" as="script"><link rel="prefetch" href="/abcjs/assets/overview.html-5b83955f.js" as="script"><link rel="prefetch" href="/abcjs/assets/render-abc-options.html-f30eb163.js" as="script"><link rel="prefetch" href="/abcjs/assets/render-abc-result.html-b419f754.js" as="script"><link rel="prefetch" href="/abcjs/assets/tablature.html-8d76a001.js" as="script"><link rel="prefetch" href="/abcjs/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/abcjs/assets/index.html-273164bb.js" as="script"><link rel="prefetch" href="/abcjs/assets/tune-book.html-062a65a9.js" as="script"><link rel="prefetch" href="/abcjs/assets/synthesized-sound.html-c47b1334.js" as="script"><link rel="prefetch" href="/abcjs/assets/deprecated-api.html-53a43408.js" as="script"><link rel="prefetch" href="/abcjs/assets/basic-architecture.html-e90fdcb7.js" as="script"><link rel="prefetch" href="/abcjs/assets/pull-requests.html-a3e4117f.js" as="script"><link rel="prefetch" href="/abcjs/assets/releasing.html-926582f2.js" as="script"><link rel="prefetch" href="/abcjs/assets/interactive-editor.html-848554a9.js" as="script"><link rel="prefetch" href="/abcjs/assets/abc-notation.html-234ccd74.js" as="script"><link rel="prefetch" href="/abcjs/assets/example-generator.html-43e1eb70.js" as="script"><link rel="prefetch" href="/abcjs/assets/examples.html-1dd831c7.js" as="script"><link rel="prefetch" href="/abcjs/assets/faq.html-2a243122.js" as="script"><link rel="prefetch" href="/abcjs/assets/getting-started.html-6b9d26b8.js" as="script"><link rel="prefetch" href="/abcjs/assets/purpose.html-670fbaab.js" as="script"><link rel="prefetch" href="/abcjs/assets/resources.html-896c19ed.js" as="script"><link rel="prefetch" href="/abcjs/assets/plugin.html-91388ee5.js" as="script"><link rel="prefetch" href="/abcjs/assets/transposing.html-13bbb34f.js" as="script"><link rel="prefetch" href="/abcjs/assets/midijs.html-0a0ef4c0.js" as="script"><link rel="prefetch" href="/abcjs/assets/release-notes.html-29e1189c.js" as="script"><link rel="prefetch" href="/abcjs/assets/classes.html-22ca3a2e.js" as="script"><link rel="prefetch" href="/abcjs/assets/click-listener.html-2acc9981.js" as="script"><link rel="prefetch" href="/abcjs/assets/dragging.html-3b0a84d7.js" as="script"><link rel="prefetch" href="/abcjs/assets/overview.html-97161312.js" as="script"><link rel="prefetch" href="/abcjs/assets/render-abc-options.html-c748ebbd.js" as="script"><link rel="prefetch" href="/abcjs/assets/render-abc-result.html-0600a7ad.js" as="script"><link rel="prefetch" href="/abcjs/assets/tablature.html-e7dd6664.js" as="script"><link rel="prefetch" href="/abcjs/assets/404.html-3943a8e2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/abcjs/" class=""><img class="logo" src="/abcjs/img/abcjs_comp_extended_08.svg" alt="abcjs"><span class="site-name can-hide">abcjs</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Overview <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/abcjs/overview/purpose.html" class="sidebar-item" aria-label="Purpose"><!--[--><!--]--> Purpose <!--[--><!--]--></a><!----></li><li><a href="/abcjs/overview/examples.html" class="sidebar-item" aria-label="Examples"><!--[--><!--]--> Examples <!--[--><!--]--></a><!----></li><li><a href="/abcjs/overview/getting-started.html" class="sidebar-item" aria-label="Getting Started"><!--[--><!--]--> Getting Started <!--[--><!--]--></a><!----></li><li><a href="/abcjs/overview/example-generator.html" class="sidebar-item" aria-label="Example Generator"><!--[--><!--]--> Example Generator <!--[--><!--]--></a><!----></li><li><a href="/abcjs/overview/abc-notation.html" class="sidebar-item" aria-label="ABC Music Notation"><!--[--><!--]--> ABC Music Notation <!--[--><!--]--></a><!----></li><li><a href="/abcjs/overview/faq.html" class="sidebar-item" aria-label="Frequently Asked Questions"><!--[--><!--]--> Frequently Asked Questions <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Visual <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/abcjs/visual/overview.html" class="sidebar-item" aria-label="Overview (renderAbc)"><!--[--><!--]--> Overview (renderAbc) <!--[--><!--]--></a><!----></li><li><a href="/abcjs/visual/render-abc-options.html" class="sidebar-item" aria-label="RenderAbc options"><!--[--><!--]--> RenderAbc options <!--[--><!--]--></a><!----></li><li><a href="/abcjs/visual/render-abc-result.html" class="sidebar-item" aria-label="return value of renderAbc"><!--[--><!--]--> return value of renderAbc <!--[--><!--]--></a><!----></li><li><a href="/abcjs/visual/classes.html" class="sidebar-item" aria-label="Classes"><!--[--><!--]--> Classes <!--[--><!--]--></a><!----></li><li><a href="/abcjs/visual/click-listener.html" class="sidebar-item" aria-label="Click Listener"><!--[--><!--]--> Click Listener <!--[--><!--]--></a><!----></li><li><a href="/abcjs/visual/dragging.html" class="sidebar-item" aria-label="Selecting and Dragging Elements"><!--[--><!--]--> Selecting and Dragging Elements <!--[--><!--]--></a><!----></li><li><a href="/abcjs/visual/tablature.html" class="sidebar-item" aria-label="Tablature"><!--[--><!--]--> Tablature <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Audio <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/abcjs/audio/synthesized-sound.html" class="sidebar-item" aria-label="Synthesized Sound"><!--[--><!--]--> Synthesized Sound <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Animation <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Timing Callbacks"><!--[--><!--]--> Timing Callbacks <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#creation" class="router-link-active router-link-exact-active sidebar-item" aria-label="Creation"><!--[--><!--]--> Creation <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#parameters" class="router-link-active router-link-exact-active sidebar-item" aria-label="Parameters"><!--[--><!--]--> Parameters <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#callbacks" class="router-link-active router-link-exact-active sidebar-item" aria-label="Callbacks"><!--[--><!--]--> Callbacks <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#beatcallback" class="router-link-active router-link-exact-active sidebar-item" aria-label="beatCallback"><!--[--><!--]--> beatCallback <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#eventcallback" class="router-link-active router-link-exact-active sidebar-item" aria-label="eventCallback"><!--[--><!--]--> eventCallback <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#lineendcallback" class="router-link-active router-link-exact-active sidebar-item" aria-label="lineEndCallback"><!--[--><!--]--> lineEndCallback <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#functions" class="router-link-active router-link-exact-active sidebar-item" aria-label="Functions"><!--[--><!--]--> Functions <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#start-position-units" class="router-link-active router-link-exact-active sidebar-item" aria-label="start(position, units)"><!--[--><!--]--> start(position, units) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#pause" class="router-link-active router-link-exact-active sidebar-item" aria-label="pause()"><!--[--><!--]--> pause() <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#stop" class="router-link-active router-link-exact-active sidebar-item" aria-label="stop()"><!--[--><!--]--> stop() <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#reset" class="router-link-active router-link-exact-active sidebar-item" aria-label="reset()"><!--[--><!--]--> reset() <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#setprogress-position-units" class="router-link-active router-link-exact-active sidebar-item" aria-label="setProgress(position, units)"><!--[--><!--]--> setProgress(position, units) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#replacetarget-visualobj" class="router-link-active router-link-exact-active sidebar-item" aria-label="replaceTarget(visualObj)"><!--[--><!--]--> replaceTarget(visualObj) <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/abcjs/animation/timing-callbacks.html#example" class="router-link-active router-link-exact-active sidebar-item" aria-label="Example"><!--[--><!--]--> Example <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Interactive <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/abcjs/interactive/interactive-editor.html" class="sidebar-item" aria-label="Interactive Editor"><!--[--><!--]--> Interactive Editor <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Transposing <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/abcjs/transposing/transposing.html" class="sidebar-item" aria-label="Transposition"><!--[--><!--]--> Transposition <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Analysis <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/abcjs/analysis/tune-book.html" class="sidebar-item" aria-label="Tune Book"><!--[--><!--]--> Tune Book <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Deprecated <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/abcjs/deprecated/deprecated-api.html" class="sidebar-item" aria-label="Deprecated API Calls"><!--[--><!--]--> Deprecated API Calls <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Developers <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/abcjs/developers/pull-requests.html" class="sidebar-item" aria-label="Pull Requests"><!--[--><!--]--> Pull Requests <!--[--><!--]--></a><!----></li><li><a href="/abcjs/developers/basic-architecture.html" class="sidebar-item" aria-label="Basic Architecture"><!--[--><!--]--> Basic Architecture <!--[--><!--]--></a><!----></li><li><a href="/abcjs/developers/releasing.html" class="sidebar-item" aria-label="Releasing"><!--[--><!--]--> Releasing <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Upgrading <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/abcjs/upgrading/release-notes.html" class="sidebar-item" aria-label="Release Notes"><!--[--><!--]--> Release Notes <!--[--><!--]--></a><!----></li><li><a href="/abcjs/upgrading/midijs.html" class="sidebar-item" aria-label="MIDI.JS Usage"><!--[--><!--]--> MIDI.JS Usage <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="timing-callbacks" tabindex="-1"><a class="header-anchor" href="#timing-callbacks" aria-hidden="true">#</a> Timing Callbacks</h1><p>This runs an animation timer and does callbacks at various intervals. This allows you to do various effects that are timed with beats or playing notes.</p><h2 id="creation" tabindex="-1"><a class="header-anchor" href="#creation" aria-hidden="true">#</a> Creation</h2><p>To use this create an instance of it:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> timingCallbacks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">abcjs<span class="token punctuation">.</span>TimingCallbacks</span><span class="token punctuation">(</span>visualObj<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th>Parameters</th><th>Description</th></tr></thead><tbody><tr><td>visualObj</td><td>This is the output of the <code>renderAbc()</code> call. It is the music that will be timed.</td></tr><tr><td>params</td><td>This is a object. See below for the possible properties.</td></tr></tbody></table><h2 id="parameters" tabindex="-1"><a class="header-anchor" href="#parameters" aria-hidden="true">#</a> Parameters</h2><table><thead><tr><th>Name</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>qpm</code></td><td>whatever is in the Q: field</td><td>Number of beats per minute.</td></tr><tr><td><code>extraMeasuresAtBeginning</code></td><td>0</td><td>Don&#39;t start the callbacks right away, but insert this number of measures first.</td></tr><tr><td><code>beatCallback</code></td><td>null</td><td>Called for each beat passing the beat number (starting at 0).</td></tr><tr><td><code>eventCallback</code></td><td>null</td><td>Called for each event (either a note, a rest, or a chord, and notes in separate voices are grouped together.)</td></tr><tr><td><code>lineEndCallback</code></td><td>null</td><td>Called at the end of each line. (This is useful if you want to be sure the music is scrolled into view at the right time.) See <code>lineEndAnticipation</code> for more details.</td></tr><tr><td><code>lineEndAnticipation</code></td><td>0</td><td>The number of milliseconds for the <code>lineEndCallback</code> to anticipate end of the line. That is, if you want to get the callback half a second before the end of the line, use 500.</td></tr><tr><td><code>beatSubdivisions</code></td><td>1</td><td>How many callbacks should happen for each beat. This allows finer control in the client, for instance, to handle a progress bar.</td></tr></tbody></table><h2 id="callbacks" tabindex="-1"><a class="header-anchor" href="#callbacks" aria-hidden="true">#</a> Callbacks</h2><h3 id="beatcallback" tabindex="-1"><a class="header-anchor" href="#beatcallback" aria-hidden="true">#</a> beatCallback</h3><p>This is called once for every beat in the tune. It is called one additional time when the tune is finished.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">beatCallback</span><span class="token punctuation">(</span><span class="token parameter">beatNumber<span class="token punctuation">,</span> totalBeats<span class="token punctuation">,</span> totalTime<span class="token punctuation">,</span> position<span class="token punctuation">,</span> debugInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>beatNumber</td><td>Zero-based beat number. Usually this will increment sequentially and regularly, but if javascript is paused long enough (for instance, if the browser tab is changed), then there may be a number of these calls at once when it catches up.</td></tr><tr><td>totalBeats</td><td>The total number of beats (including all repeats) that will be played.</td></tr><tr><td>totalTime</td><td>The total number of milliseconds of the tune.</td></tr><tr><td>position</td><td>The interpolated position of the cursor if the beat occurs between notes. This is an object with the attributes { left: , top: , height: } This can be used to smooth out the cursor by moving it on the beat callbacks. The higher the number of <code>beatSubdivisions</code> the smoother the cursor will be.</td></tr><tr><td>debugInfo</td><td>A hash of some extra info that might be useful in figuring out why the callback was triggered.</td></tr></tbody></table><h3 id="eventcallback" tabindex="-1"><a class="header-anchor" href="#eventcallback" aria-hidden="true">#</a> eventCallback</h3><p>This is called once for every &quot;event&quot; in time - either a note or a rest. If there are multiple notes at the same time, then it is only called once for that group of notes.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">eventCallback</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The parameter <code>ev</code> is an object that looks like this:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>ev <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;event&quot;</span><span class="token punctuation">,</span> <span class="token comment">// This is always &quot;event&quot;</span>

    <span class="token string-property property">&quot;milliseconds&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The number of milliseconds from the beginning of the piece</span>
    <span class="token string-property property">&quot;millisecondsPerMeasure&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The number of milliseconds per measure</span>

    <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The current &quot;line&quot;, that is, the staff system.</span>
    <span class="token string-property property">&quot;measureNumber&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The measure number. Resets per line, so the first measure number on a line is zero.</span>

    <span class="token string-property property">&quot;top&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The number of pixels from the top of the svg that the note appears.</span>
    <span class="token string-property property">&quot;height&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The height of the note, in pixels. </span>
    <span class="token string-property property">&quot;left&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The number of pixels from the left edge of the svg.</span>
    <span class="token string-property property">&quot;width&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The width of the note</span>

    <span class="token string-property property">&quot;elements&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// Array of the actual elements on the page that are represented by the note or notes.</span>
    <span class="token string-property property">&quot;startCharArray&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> number <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// the character position in the original abc string</span>
    <span class="token string-property property">&quot;endCharArray&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> number <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// the character position in the original abc string</span>
    <span class="token string-property property">&quot;midiPitches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// Array of the currently playing pitches</span>
        <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;pitch&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The pitch number (based on the midi standard, i.e. middle C is 60)</span>
            <span class="token string-property property">&quot;durationInMeasures&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// the note value as a fraction. (that is, a quarter note is 0.025)</span>
            <span class="token string-property property">&quot;volume&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The volume expressed as a number between 0 and 127</span>
            <span class="token string-property property">&quot;instrument&quot;</span><span class="token operator">:</span> number <span class="token comment">// The instrument number (based on the midi standard, i.e. acoustic_grand_piano is 0)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="notes" tabindex="-1"><a class="header-anchor" href="#notes" aria-hidden="true">#</a> Notes:</h4><ul><li><p>The <code>startCharArray</code> and <code>endCharArray</code> are arrays because there is more than one location in the abc string if there is more than one voice.</p></li><li><p>The format of the <code>elements</code> array is subject to change in future versions.</p></li><li><p>This is called one last time with passing in <code>null</code> at the end of the tune. On that call <code>eventCallback</code> can return the string &quot;continue&quot; to keep the timer from stopping. This is useful if you want to play on repeat - in theory you would probably have another call to <code>seek()</code>.</p></li><li><p>This function can be a Promise or not.</p></li></ul><h3 id="lineendcallback" tabindex="-1"><a class="header-anchor" href="#lineendcallback" aria-hidden="true">#</a> lineEndCallback</h3><p>This will be called as the cursor is approaching the end of a line of music. This is useful if there is more than a screen&#39;s worth of music; it can be used to scroll the page at the right time.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">lineEndCallback</span><span class="token punctuation">(</span><span class="token parameter">info<span class="token punctuation">,</span> event<span class="token punctuation">,</span> details</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The parameter <code>info</code> looks like this:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>info <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;milliseconds&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// current milliseconds from beginning of piece</span>
    <span class="token string-property property">&quot;top&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// The number of pixels from the top of the svg to the top of the cursor</span>
    <span class="token string-property property">&quot;bottom&quot;</span><span class="token operator">:</span> number <span class="token comment">// The number of pixels from the top of the svg to the bottom of the cursor</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The parameter <code>event</code> is the standard note event.</p><p>The parameter <code>details</code> looks like this:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>details <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// the current line number (zero-based)</span>
    <span class="token string-property property">&quot;endTimings&quot;</span><span class="token operator">:</span> array <span class="token comment">// the array of the timings for each line</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>endTimings</code> array elements are of the same type as the <code>info</code> parameter.</p><h2 id="functions" tabindex="-1"><a class="header-anchor" href="#functions" aria-hidden="true">#</a> Functions</h2><p>These are the entry points that can be called on the <code>timingCallbacks</code> object.</p><h3 id="start-position-units" tabindex="-1"><a class="header-anchor" href="#start-position-units" aria-hidden="true">#</a> start(position, units)</h3><p>This starts the timer that triggers the callbacks. This is called to both start and resume after calling pause. See the <code>setProgress</code> method below for explanation of the parameters with one special case:</p><p>If <code>position</code> is undefined then if the previous call was to <code>pause()</code>, then the animation continues from where it left off. If there was no pause, then the animation starts from the beginning.</p><h3 id="pause" tabindex="-1"><a class="header-anchor" href="#pause" aria-hidden="true">#</a> pause()</h3><p>Pauses the animation. Calling <code>start()</code> afterwards will resume from where it left off.</p><h3 id="stop" tabindex="-1"><a class="header-anchor" href="#stop" aria-hidden="true">#</a> stop()</h3><p>Stop the animation. After calling this, the next call to <code>start()</code> will start at the beginning.</p><h3 id="reset" tabindex="-1"><a class="header-anchor" href="#reset" aria-hidden="true">#</a> reset()</h3><p>Move the timer back to the beginning, so the animation starts over. This can be called either when the animation is currently running or when it is paused.</p><h3 id="setprogress-position-units" tabindex="-1"><a class="header-anchor" href="#setprogress-position-units" aria-hidden="true">#</a> setProgress(position, units)</h3><p>Change the position of the animation. This allows random access to any place in the tune.</p><p>If the second parameter is not present, then <code>units</code> equals &quot;percent&quot;. The possible values are:</p><ul><li><p><code>&quot;percent&quot;</code>: The percent passed in is a number between 0 and 1. This can be called either when the animation is currently running or when it is paused.</p></li><li><p><code>&quot;seconds&quot;</code>: The seconds from the beginning of the tune. If this is passed the end of the tune it is changed to the end.</p></li><li><p><code>&quot;beats&quot;</code>: The beats from the beginning of the tune. If this is passed the end of the tune it is changed to the end.</p></li></ul><h3 id="replacetarget-visualobj" tabindex="-1"><a class="header-anchor" href="#replacetarget-visualobj" aria-hidden="true">#</a> replaceTarget(visualObj)</h3><p>If the underlying music changes on the fly, this replaces the current object without having to destroy the object and start over. <code>visualObj</code> is the return value from <code>renderAbc</code>.</p><h2 id="example" tabindex="-1"><a class="header-anchor" href="#example" aria-hidden="true">#</a> Example</h2><p>Paste in any ABC you want here then click &quot;start&quot; to see what is returned by the timing callbacks:</p><!----><div class="timing-callbacks" data-v-b942f523><form data-v-b942f523><div class="language- my-code" data-v-b942f523><div data-v-b942f523>timer = new abcjs.TimingCallbacks(visualObj, {</div><label data-v-b942f523><span data-v-b942f523>qpm: </span><input type="number" min="4" max="300" step="4" value="100" data-v-b942f523>, </label><label data-v-b942f523><span data-v-b942f523>extraMeasuresAtBeginning: </span><input type="number" min="0" max="4" value="0" data-v-b942f523>, </label><label data-v-b942f523><span data-v-b942f523>lineEndAnticipation: </span><input type="number" min="0" max="4000" step="100" value="500" data-v-b942f523>, </label><label data-v-b942f523><span data-v-b942f523>beatSubdivisions: </span><input type="number" min="1" max="8" value="4" data-v-b942f523>, </label><div data-v-b942f523></div><div class="label-indent" data-v-b942f523>beatCallback: function() {...},</div><div class="label-indent" data-v-b942f523>eventCallback: function() {...},</div><div class="label-indent" data-v-b942f523>lineEndCallback: function() {...}</div><div data-v-b942f523>}</div></div><button type="submit" data-v-b942f523>Start()</button></form><button data-v-b942f523>Stop()</button><button data-v-b942f523>Pause()</button><button data-v-b942f523>Reset()</button><button data-v-b942f523>Set Progress(10)</button><div data-v-b942f523><h3 data-v-b942f523>Output Stream:</h3><div class="output" data-v-b942f523></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: paul@paulrosen.net">Paul Rosen</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/abcjs/assets/app-59542f1f.js" defer></script>
  </body>
</html>
